---
layout: post
title: "高性能javascript笔记：第1章 加载和执行"
description: ""
category: js
tags: [Javascript]
---
{% include JB/setup %}

##第1章 加载和执行
###1.1 脚本位置
Javascript具有阻塞特性，即浏览器在执行Javascript的时候，不能同时做其他任何事情。Javascript执行过程耗时越久，浏览器等待响应用户输入的时间就越长。

`<script>`标签在下载外部资源的时候不会阻塞其他`<script>`标签，但js的下载过程仍然会阻塞其他资源的下载，比如图片。尽管脚本的下载过程不会互相影响，但也没仍然必须等待所有Javascript代码**下载并执行**完成才能继续。

因此推荐将所有的`<script>`标签尽可能放到`<body>`标签的底部，以尽量减少对整个页面下载的影响。

###1.2 组织脚本
浏览器在解析html页面的过程中每遇到一个`<script>`标签，都会因执行脚本而导致一定的延时，且每个`<script>`标签初始下载时都会阻塞页面渲染，因此减少页面所包含的`<script>`标签数量有助于改善页面的总体性能。

>提示：把一段内嵌脚本放在引用外链样式表的`<link>`标签之后会导致页面阻塞去等待样式表的下载，这样做是为了确保内嵌脚本在执行时能获得最精准的样式信息。因此Steve Sounders建议*永远不要把内嵌脚本紧跟在`<link>`标签之后*。


###1.3 无阻塞的脚本
减少Javascript文件大小并限制HTTP请求数仅仅是创建相应迅速的web应用的第一步。web应用功能越丰富，需要的js代码越多，精简源代码并总是可行。尽管下载单个较大的js文件只产生一次http请求，却会锁死浏览器一大段时间。为避免这种情况，需要向页面中逐步加载Javascript文件，这样做在某种程度上来说不会阻塞浏览器。

无阻塞脚本的秘诀在于，在页面加载完成后才加载Javascript代码，即在window对象的load事件触发后再下载脚本。

**延迟的脚本**
html4为`<script>`标签定义了一个扩展属性：defer。Defer属性指明本元素所含的脚本不会修改DOM，因此代码能安全的延迟执行。
在不支持的浏览器中，defer属性会直接被忽略。

>之前本书说只有IE4+和Firefox3.5+的浏览器支持，我查了下，最新的支持度可查看[本链接](http://caniuse.com/script-defer),而w3c更是说这个属性支持大部分主流浏览器，为了证实，回头写个测试页面跑一下，看看在手机上支持性到底如何。

带有defer属性的`<script>`标签可以放置在文档的任何位置。对应的Javascript文件将在页面解析到`<script>`标签时开始下载，但并不会执行，直到DOM加载完成（onload事件被触发前）。当一个带有defer属性的javascript文件下载时，它不会阻塞浏览器的其他进程，因此这类文件可以与页面中的其他资源并行下载。

任何带有defer属性的`<script>`元素在DOM完成加载之前都不会执行，无论内嵌或外链脚本都是如此。（奇怪的是，[w3c](http://www.w3schools.com/tags/att_script_defer.asp)上却说， The defer attribute is only for external scripts ...我就无语了，还是先自己测试吧...）


**动态脚本元素**



1.将脚本放到底部,`<body>`标签之前，这能确保在脚本执行前页面已完成了渲染。
2.合并脚本，减少页面包含的`<script>`标签的数量。
3.有多种无阻塞下载Javascript的方法：
*使用`<script>`标签的defer属性（浏览器支持有限）
*使用动态创建的`<script>`元素下载并执行代码
*使用XHR对象下载Javascript代码并诸如页面